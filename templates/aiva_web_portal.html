<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>AIVA - Web App</title>
  <!-- ‚≠êÔ∏è CSS ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏° (‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏°‡∏≤‡∏à‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏î‡∏¥‡∏°‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì) -->
  <style>
    :root {
      --logo-width: 80vw;
      --tagline-size: 3rem;
      --video-frame-width: 600px;
      --video-frame-height: 900px;
      --video-width: 550px;
      --video-height: 850px;
      --button-font-size: 2.9rem;
      --button-width: 600px;
      --button-height: 120px;
      --button-radius: 18px;
      --button-border: 3px;
      --mic-size: 150px;
      --mic-font-size: 2.9rem;
    }
    html { box-sizing: border-box; }
    *, *:before, *:after { box-sizing: inherit; }
    body {
      margin: 0;
      min-height: 100vh;
      min-width: 100vw;
      font-family: 'Kanit', Tahoma, Arial, sans-serif;
      background: url('{{ url_for("static", filename="bg.png") }}') no-repeat center center fixed;
      background-size: cover;
      position: relative;
    }
    .container {
      width: 100vw;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      position: relative;
      z-index: 1;
    }
    .aiva-logo {
      margin-top: 36px;
      width: var(--logo-width);
    }
    .aiva-tagline {
      color: #fff;
      font-size: var(--tagline-size );
      font-weight: bold;
      margin-top: -40px;
      text-shadow: 0 2px 14px #000;
      text-align: center;
      letter-spacing: 0.04em;
    }
    .main-content {
      display: flex;
      flex-direction: row;
      justify-content: center;
      align-items: flex-start;
      margin-top: 36px;
      min-height: 420px;
      width: 100vw;
      position: relative;
      z-index: 1;
    }
    .video-and-speech {
      display: flex;
      flex-direction: column;
      align-items: center;
      margin-right: 48px;
      position: relative;
    }
    .video-frame {
      width: var(--video-frame-width);
      height: var(--video-frame-height);
      background: #18ed1800;
      border-radius: 44px;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 0 24px #0006;
    }
    .bot-video {
      width: var(--video-width);
      height: var(--video-height);
      border-radius: 36px;
      object-fit: cover;
      background: #222;
      display: block;
    }
    .right-panel {
      position: relative;
      display: flex;
      flex-direction: column;
      align-items: center;
      margin-top: 20px;
      width: 320px;
    }
    .actions {
      position: relative;
      display: flex;
      flex-direction: column;
      align-items: stretch;
      gap: 60px;
      width: 100%;
      margin-left: 75px;
    }
    .button-aiva {
      border: none;
      outline: none;
      font-size: var(--button-font-size );
      color: #fff;
      background: linear-gradient(90deg, #205FCF 70%, #265FF6 97%);
      border-radius: var(--button-radius);
      box-shadow: 0 4px 16px #07142218;
      width: var(--button-width);
      height: var(--button-height);
      min-width: 160px;
      cursor: pointer;
      position: relative;
      transition: background 0.2s, opacity 0.2s;
      letter-spacing: 2px;
      font-weight: bold;
      text-shadow: 0 2px 12px #2355ff77;
      border: var(--button-border) solid #24DDFF;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .button-aiva:hover {
      filter: brightness(1.09);
    }
    .button-aiva:disabled {
      opacity: 0.7;
      cursor: not-allowed;
      filter: brightness(0.8);
    }
    .mic-float {
      position: absolute;
      left: 115%;
      bottom: -250px;
      transform: translateX(-50%);
      margin: 0;
      display: flex;
      flex-direction: row;
      align-items: center;
      gap: 24px;
    }
    .mic-btn-image {
      width: var(--mic-size);
      height: var(--mic-size);
      padding: 1px;
      border: none;
      background: none;
      border-radius: 50%;
      box-shadow: 0 8px 34px #48fff977;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: box-shadow 0.2s, transform 0.2s;
      position: relative;
      z-index: 1;
    }
    .mic-btn-image:active {
      transform: scale(1.1) rotate(-6deg);
      box-shadow: 0 0 48px #4adcf7cc;
    }
    .mic-btn-image:disabled {
        opacity: 0.7;
        cursor: not-allowed;
    }
    .mic-btn-image.active {
      background: radial-gradient(circle, #c6e4fc 0%, #99e8ff90 70%, #6146e7 100%);
      box-shadow: 0 0 56px #65ebfd, 0 0 0 16px #ffffff18;
      transition: background 0.2s, box-shadow 0.3s;
    }
    .mic-img {
      width: 100%;
      height: 100%;
      object-fit: contain;
      border-radius: 50%;
      display: block;
      transition: transform 0.7s cubic-bezier(.24,1.56,.28,.78);
    }
    .mic-btn-image.active .mic-img {
      animation: mic-rotate 1s linear infinite;
    }
    @keyframes mic-rotate {
      0% { transform: rotate(0deg);}
      100% { transform: rotate(360deg);}
    }
    .mic-stop-btn {
      width: 100px;
      height: 100px;
      background: radial-gradient(circle at 60% 30%, #e96487 60%, #715de7 120%);
      border: none;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 0 24px #e9648799, 0 4px 16px #4738c966;
      transition: box-shadow 0.2s, transform 0.2s;
      cursor: pointer;
      position: relative;
    }
    .mic-stop-btn:hover {
      box-shadow: 0 0 40px #e96487cc, 0 6px 28px #715de7cc;
      transform: scale(1.07);
    }
    .mic-stop-icon {
      width: 40px;
      height: 40px;
      background: #fff;
      border-radius: 6px;
      box-shadow: 0 0 6px #fff8;
    }
    .speech-box {
      position: static;
      margin: 32px auto 0 auto;
      display: none;
      min-width: 340px;
      max-width: 480px;
      width: 78vw;
      min-height: 105px;
      padding: 32px 36px 28px 36px;
      background: rgba(255,255,255,0.19);
      border-radius: 34px;
      box-shadow: 0 12px 34px #0003, 0 0 0 6px #a5e9fc1f;
      backdrop-filter: blur(14px);
      z-index: 30;
      flex-direction: column;
      align-items: center;
      animation: popbox 0.44s cubic-bezier(.23,2,.19,.98);
    }
    @keyframes popbox {
      0% { opacity:0; transform:scale(0.7) translateY(80px);}
      60% { opacity:1; transform:scale(1.09) translateY(-20px);}
      100% { opacity:1; transform:scale(1) translateY(0);}
    }
    .speech-header {
      width: 100%;
      display: flex;
      gap: 12px;
      align-items: center;
      margin-bottom: 18px;
      font-size: 2.1rem;
      color: #2856b8;
      font-weight: bold;
      letter-spacing: 1.2px;
      text-shadow: 0 2px 8px #fff6;
    }
    .speech-mic { font-size: 2.7rem; vertical-align: middle;}
    .speech-live-text {
      width: 100%;
      min-height: 50px;
      font-size: 1.65rem;
      color: #191b2b;
      font-weight: 600;
      text-shadow: 0 1px 10px #fff7;
      line-height: 1.6;
      transition: all 0.2s;
      letter-spacing: 0.5px;
      text-align: center;
    }
    .mic-loading-overlay {
      position: fixed;
      top: 0; left: 0;
      width: 100vw;
      height: 100vh;
      background: rgba(50,70,104,0.37);
      z-index: 100;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: opacity 0.3s;
      pointer-events: none;
      opacity: 0;
      visibility: hidden;
    }
    .mic-loading-overlay.active {
      opacity: 1;
      pointer-events: auto;
      visibility: visible;
    }
    .emoji-loader-wrap {
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 28px 32px 10px 32px;
      background: rgba(255,255,255,0.085);
      border-radius: 28px;
      box-shadow: 0 12px 36px #2c54ee28;
    }
    .emoji-bounce {
      display: flex;
      gap: 26px;
    }
    .emoji {
      font-size: 4.5rem;
      filter: drop-shadow(0 4px 22px hsl(var(--hue,210),90%,76%,0.30))
            hue-rotate(var(--hue,0)deg);
      animation: emoji-bounce 1s infinite cubic-bezier(.25,1.52,.29,1.03);
    }
    .emoji:nth-child(2) { animation-delay: 0.24s;}
    .emoji:nth-child(3) { animation-delay: 0.48s;}
    @keyframes emoji-bounce {
      0%,100% { transform: translateY(0);}
      45% { transform: translateY(-34px) scale(1.09);}
      60% { transform: scale(1);}
    }
    .mic-loader-message {
      margin-top: 28px;
      font-size: 2.1rem;
      color: #293c58;
      text-shadow: 0 2px 8px #fff7;
      font-weight: 700;
      letter-spacing: 1.2px;
      animation: message-blink 1.24s infinite alternate;
    }
    @keyframes message-blink {
      0%,100% { opacity: 1;}
      55% { opacity: 0.8;}
    }
    @media (max-width: 750px) {
      .main-content { flex-direction: column; align-items: center; }
      .video-and-speech { margin-right: 0;}
      .video-frame { width: 87vw; height: auto;}
      .speech-box{ min-width:120px; width:97vw; font-size:1.09rem;}
    }
  </style>
</head>
<body>
  <div class="container">
    <img class="aiva-logo" src="{{ url_for('static', filename='logo01.png') }}" alt="AIVA Logo"/>
    <div class="aiva-tagline">‡∏ú‡∏π‡πâ‡∏ä‡πà‡∏ß‡∏¢‡∏≠‡∏±‡∏à‡∏â‡∏£‡∏¥‡∏¢‡∏∞‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏±‡∏á‡∏Ñ‡∏°‡∏≠‡∏≤‡∏ä‡∏µ‡∏ß‡∏∞‡πÅ‡∏´‡πà‡∏á‡∏≠‡∏ô‡∏≤‡∏Ñ‡∏ï</div>
    <div class="main-content">
      <div class="video-and-speech">
        <div class="video-frame">
          <video class="bot-video" controls autoplay loop muted>
            <source src="{{ url_for('static', filename='aivavideo.mp4') }}" type="video/mp4">
            ‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠
          </video>
        </div>
        <div class="speech-box" id="speech-box">
          <div class="speech-header">
            <span class="speech-mic">üé§</span>
            <span class="speech-status" id="speech-status">‡∏û‡∏π‡∏î‡πÄ‡∏•‡∏¢...</span>
          </div>
          <div class="speech-live-text" id="speech-live-text"></div>
        </div>
      </div>
      <div class="right-panel">
        <div class="actions">
          <button class="button-aiva">‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ö‡∏™‡∏°‡∏±‡∏Ñ‡∏£</button>
          <button class="button-aiva">‡∏´‡∏•‡∏±‡∏Å‡∏™‡∏π‡∏ï‡∏£</button>
          <button class="button-aiva">‡∏≠‡∏≤‡∏ä‡∏µ‡∏û</button>
          <div class="mic-float mic-center">
            <button class="mic-btn-image" id="mic-btn" title="‡∏û‡∏π‡∏î">
              <img src="{{ url_for('static', filename='pu.png') }}" alt="Mic Wave" class="mic-img">
            </button>
            <button class="mic-stop-btn" id="stop-btn" title="‡∏´‡∏¢‡∏∏‡∏î‡∏û‡∏π‡∏î">
              <div class="mic-stop-icon"></div>
            </button>
          </div>
        </div>
      </div>
    </div>
    <div class="mic-loading-overlay" id="mic-loader">
      <div class="emoji-loader-wrap">
        <div class="emoji-bounce">
          <span class="emoji" style="--hue: 190;">üéß</span>
          <span class="emoji" style="--hue: 340;">ü§ñ</span>
          <span class="emoji" style="--hue: 75;">üéµ</span>
        </div>
        <div class="mic-loader-message" id="mic-loader-message">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏£‡∏±‡∏ö‡∏ü‡∏±‡∏á‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì...</div>
      </div>
    </div>
  </div>
  
  <!-- ‚≠êÔ∏è 1. ‡πÄ‡∏û‡∏¥‡πà‡∏° Audio Player ‡∏ó‡∏µ‡πà‡∏ã‡πà‡∏≠‡∏ô‡πÑ‡∏ß‡πâ ‚≠êÔ∏è -->
  <audio id="audio-player" style="display: none;"></audio>

  <!-- ‚≠êÔ∏è‚≠êÔ∏è SCRIPT SECTION (Web App Logic) ‚≠êÔ∏è‚≠êÔ∏è -->
  <script>
  document.addEventListener('DOMContentLoaded', () => {
      // ‡∏î‡∏∂‡∏á element ‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ
      const micBtn = document.getElementById('mic-btn');
      const stopBtn = document.getElementById('stop-btn');
      const loader = document.getElementById('mic-loader');
      const loaderMessage = document.getElementById('mic-loader-message');
      const speechBox = document.getElementById('speech-box');
      const speechStatus = document.getElementById('speech-status');
      const speechLive = document.getElementById('speech-live-text');
      const buttons = document.querySelectorAll('.button-aiva');
      
      // ‚≠êÔ∏è 2. ‡∏î‡∏∂‡∏á Audio Player
      const audioPlayer = document.getElementById('audio-player');

      // ‚≠êÔ∏è 3. ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Web Speech API (STT ‡∏ù‡∏±‡πà‡∏á Client)
      const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
      let recognition = null;

      if (SpeechRecognition) {
          recognition = new SpeechRecognition();
          recognition.lang = 'th-TH'; // ‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢
          recognition.interimResults = false; // ‡πÄ‡∏≠‡∏≤‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢
          recognition.maxAlternatives = 1;
      } else {
          console.error("Web Speech API is not supported in this browser.");
          // ‡∏ã‡πà‡∏≠‡∏ô‡∏õ‡∏∏‡πà‡∏°‡πÑ‡∏°‡∏Ñ‡πå‡∏ñ‡πâ‡∏≤‡πÉ‡∏ä‡πâ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ
          micBtn.style.display = 'none'; 
      }

      // --- Helper Functions ---

      function showSpeechBox(status, text) {
          speechBox.style.display = "flex";
          speechStatus.textContent = status;
          speechLive.textContent = text;
      }

      function hideSpeechBox() {
          speechBox.style.display = "none";
          speechLive.textContent = "";
          speechStatus.textContent = "";
      }
      
      function resetUI() {
          micBtn.disabled = false;
          micBtn.classList.remove('active');
          loader.classList.remove('active');
          
          buttons.forEach(btn => {
              btn.disabled = false;
              btn.style.opacity = '1';
          });
      }

      // --- Core Web App Functions ---

      /**
       * ‚≠êÔ∏è 4. ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏´‡∏•‡∏±‡∏Å: ‡∏™‡πà‡∏á Text ‡πÑ‡∏õ Backend ‡πÅ‡∏•‡∏∞‡∏£‡∏±‡∏ö‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏™‡∏µ‡∏¢‡∏á MP3 ‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡πÄ‡∏•‡πà‡∏ô
       */
      async function getAudioAnswer(questionText) {
          // ‡∏´‡∏¢‡∏∏‡∏î‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏•‡πà‡∏ô‡∏Ñ‡πâ‡∏≤‡∏á
          audioPlayer.pause();
          audioPlayer.src = '';
          
          // ‡πÅ‡∏™‡∏î‡∏á‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏ö‡∏ô‡∏à‡∏≠
          showSpeechBox(questionText, "AIVA ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö...");
          
          // ‡∏•‡πá‡∏≠‡∏Å‡∏õ‡∏∏‡πà‡∏°
          micBtn.disabled = true;
          buttons.forEach(btn => btn.disabled = true);

          try {
              console.log(`Sending text to backend: ${questionText}`);
              
              const response = await fetch('/get_answer_audio', {
                  method: 'POST',
                  headers: { 'Content-Type': 'application/json' },
                  body: JSON.stringify({ question: questionText })
              });

              if (!response.ok) {
                  throw new Error(`Server error: ${response.statusText}`);
              }

              // 5. ‡∏£‡∏±‡∏ö‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÄ‡∏õ‡πá‡∏ô Blob (Binary Large Object)
              const audioBlob = await response.blob();
              
              // 6. ‡∏™‡∏£‡πâ‡∏≤‡∏á URL ‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÑ‡∏ü‡∏•‡πå Blob
              const audioUrl = URL.createObjectURL(audioBlob);
              
              // 7. ‡∏™‡∏±‡πà‡∏á‡πÉ‡∏´‡πâ Audio Player ‡πÄ‡∏•‡πà‡∏ô
              audioPlayer.src = audioUrl;
              audioPlayer.play();
              
              showSpeechBox(questionText, "AIVA ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏û‡∏π‡∏î..."); // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞

          } catch (error) {
              console.error('Error getting audio answer:', error);
              showSpeechBox("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î", error.message);
              resetUI();
          }
      }

      /**
       * ‚≠êÔ∏è 8. ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏ü‡∏±‡∏á‡πÄ‡∏™‡∏µ‡∏¢‡∏á (‡∏à‡∏≤‡∏Å Web Speech API)
       */
      function startVoiceListen() {
          if (!recognition) return;

          // ‡∏´‡∏¢‡∏∏‡∏î‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏•‡πà‡∏ô‡∏Ñ‡πâ‡∏≤‡∏á
          audioPlayer.pause();
          audioPlayer.src = '';
          hideSpeechBox();
          
          micBtn.disabled = true;
          micBtn.classList.add('active'); // Animation ‡∏´‡∏°‡∏∏‡∏ô
          loaderMessage.textContent = "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏£‡∏±‡∏ö‡∏ü‡∏±‡∏á‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì...";
          loader.classList.add('active'); // Overlay
          
          try {
              recognition.start();
          } catch(e) {
              console.error("Recognition already started.", e);
              resetUI();
          }
      }

      /**
       * ‚≠êÔ∏è 9. ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î‡∏ó‡∏∏‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á
       */
      function stopAll() {
          console.log("Stop button pressed.");
          if (recognition) {
              recognition.stop(); // ‡∏´‡∏¢‡∏∏‡∏î‡∏Å‡∏≤‡∏£‡∏à‡∏î‡∏à‡∏≥‡πÄ‡∏™‡∏µ‡∏¢‡∏á
          }
          audioPlayer.pause(); // ‡∏´‡∏¢‡∏∏‡∏î‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏•‡πà‡∏ô
          audioPlayer.src = '';
          hideSpeechBox();
          resetUI();
      }

      // --- Event Listeners ---

      // ‚≠êÔ∏è 10. ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏õ‡∏∏‡πà‡∏° 3 ‡∏õ‡∏∏‡πà‡∏°‡∏´‡∏•‡∏±‡∏Å
      const questions = [
          '‡∏™‡∏≠‡∏ö‡∏ñ‡∏≤‡∏°‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ö‡∏™‡∏°‡∏±‡∏Ñ‡∏£',
          '‡∏™‡∏≠‡∏ö‡∏ñ‡∏≤‡∏°‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏´‡∏•‡∏±‡∏Å‡∏™‡∏π‡∏ï‡∏£‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡∏¥‡∏î‡∏™‡∏≠‡∏ô',
          '‡∏à‡∏ö‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏≠‡∏∞‡πÑ‡∏£‡πÑ‡∏î‡πâ‡∏ö‡πâ‡∏≤‡∏á'
      ];

      buttons.forEach((btn, i) => {
          btn.addEventListener('click', (e) => {
              const originalText = e.target.innerText;
              
              // ‡πÅ‡∏™‡∏î‡∏á Feedback ‡∏ó‡∏µ‡πà‡∏õ‡∏∏‡πà‡∏°
              e.target.disabled = true;
              e.target.innerText = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏û‡∏π‡∏î...';
              e.target.style.opacity = '0.7';

              // ‡∏™‡πà‡∏á Text ‡πÑ‡∏õ‡πÄ‡∏≠‡∏≤‡πÄ‡∏™‡∏µ‡∏¢‡∏á
              getAudioAnswer(questions[i]);
              
              // (‡πÄ‡∏£‡∏≤‡∏à‡∏∞ reset ‡∏õ‡∏∏‡πà‡∏°‡πÉ‡∏ô 'audioPlayer.onended')
          });
      });

      // ‚≠êÔ∏è 11. ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏õ‡∏∏‡πà‡∏°‡πÑ‡∏°‡∏Ñ‡πå
      micBtn.addEventListener('click', startVoiceListen);
      
      // ‚≠êÔ∏è 12. ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏õ‡∏∏‡πà‡∏°‡∏´‡∏¢‡∏∏‡∏î
      stopBtn.addEventListener('click', stopAll);

      // --- Event Listeners ‡∏Ç‡∏≠‡∏á API ---

      // ‚≠êÔ∏è 13. ‡πÄ‡∏°‡∏∑‡πà‡∏≠ Audio Player ‡πÄ‡∏•‡πà‡∏ô‡∏à‡∏ö
      audioPlayer.addEventListener('ended', () => {
          console.log("Audio finished playing.");
          hideSpeechBox();
          resetUI();
          
          // ‡∏Ñ‡∏∑‡∏ô‡∏Ñ‡πà‡∏≤‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏∏‡πà‡∏°
          buttons.forEach((btn, i) => {
              btn.innerText = questions[i];
          });
      });

      // ‚≠êÔ∏è 14. ‡πÄ‡∏°‡∏∑‡πà‡∏≠ Web Speech API ‡πÑ‡∏î‡πâ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå
      if(recognition) {
          recognition.addEventListener('result', (event) => {
              const userText = event.results[0][0].transcript;
              console.log('User said:', userText);
              
              // ‡πÑ‡∏î‡πâ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏•‡πâ‡∏ß, ‡∏™‡πà‡∏á‡πÑ‡∏õ‡πÄ‡∏≠‡∏≤‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏™‡∏µ‡∏¢‡∏á
              getAudioAnswer(userText);
          });
          
          // ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏´‡∏¢‡∏∏‡∏î‡∏ü‡∏±‡∏á (‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏à‡∏∞‡∏û‡∏π‡∏î‡∏à‡∏ö ‡∏´‡∏£‡∏∑‡∏≠‡∏Å‡∏î‡∏´‡∏¢‡∏∏‡∏î)
          recognition.addEventListener('end', () => {
              console.log("Speech recognition ended.");
              // ‡∏ã‡πà‡∏≠‡∏ô Loader (resetUI ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ô onended ‡∏Ç‡∏≠‡∏á audio)
              loader.classList.remove('active');
              micBtn.classList.remove('active');
              // micBtn.disabled ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏õ‡∏•‡∏î‡∏•‡πá‡∏≠‡∏Å‡πÇ‡∏î‡∏¢ onended ‡∏Ç‡∏≠‡∏á audio
          });

          recognition.addEventListener('error', (event) => {
              console.error('Speech recognition error:', event.error);
              showSpeechBox("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î", event.error);
              stopAll(); // ‡∏´‡∏¢‡∏∏‡∏î‡∏ó‡∏∏‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ñ‡πâ‡∏≤ error
          });
      }
      
  });
  </script>
</body>
</html>